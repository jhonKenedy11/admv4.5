-- =====================================================
-- ALTERAÇÕES NECESSÁRIAS PARA ATUALIZAR BANCO ADM v4.5
-- =====================================================
-- Data: $(date)
-- Versão: 4.5
-- Descrição: Script de alterações para bancos existentes
-- =====================================================

-- 1. ADICIONAR CAMPO BLOQUEADO NA TABELA FAT_COND_PGTO
-- =====================================================
ALTER TABLE `FAT_COND_PGTO` 
ADD COLUMN `BLOQUEADO` char(1) NOT NULL DEFAULT 'A' AFTER `SITUACAOLCTO`;

-- 2. ALTERAR TABELA EST_GRUPO PARA AUTO_INCREMENT E ADICIONAR CAMPOS DE AUDITORIA
-- =====================================================
-- Primeiro, criar tabela temporária com nova estrutura
CREATE TABLE `EST_GRUPO_NEW` (  
  `ID` int NOT NULL AUTO_INCREMENT,
  `GRUPO` varchar(15) NOT NULL,
  `DESCRICAO` varchar(40) NOT NULL,
  `TIPO` char(1) NOT NULL,
  `NIVEL` smallint NOT NULL,
  `COMISSAOVENDAS` decimal(5,2) DEFAULT NULL,
  `USERINSERT` int DEFAULT NULL,
  `DATEINSERT` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `USERCHANGE` int DEFAULT NULL,
  `DATECHANGE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- Copiar dados existentes (ajustar conforme necessário)
INSERT INTO `EST_GRUPO_NEW` (`DESCRICAO`, `TIPO`, `NIVEL`)
SELECT `DESCRICAO`, `TIPO`, `NIVEL` FROM `EST_GRUPO`;

-- Remover tabela antiga e renomear nova
DROP TABLE `EST_GRUPO`;
RENAME TABLE `EST_GRUPO_NEW` TO `EST_GRUPO`;

-- 3. ADICIONAR CAMPO CASASDECIMAIS NA TABELA FAT_PARAMETRO
-- =====================================================
ALTER TABLE `FAT_PARAMETRO` 
ADD COLUMN `CASASDECIMAIS` int DEFAULT 4 NOT NULL AFTER `TIPODESCONTO`;

-- 4. ADICIONAR CAMPO OBRA_ID NA TABELA FAT_PEDIDO
-- =====================================================
ALTER TABLE `FAT_PEDIDO` 
ADD COLUMN `OBRA_ID` int DEFAULT NULL AFTER `OS`;

-- 5. ADICIONAR CAMPO OBSSERVICO E ALTERAR UNIDADE NA TABELA FAT_PEDIDO_SERVICO
-- =====================================================
-- Adicionar campo OBSSERVICO
ALTER TABLE `FAT_PEDIDO_SERVICO`
ADD COLUMN `OBSSERVICO` text AFTER `DESCSERVICO`;

-- Alterar campo UNIDADE para suportar mais caracteres e UTF-8 completo
ALTER TABLE `FAT_PEDIDO_SERVICO` 
MODIFY COLUMN `UNIDADE` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL;

-- Alterar a tabela para usar UTF-8 completo
ALTER TABLE `FAT_PEDIDO_SERVICO` 
CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 6. CRIAR TABELA FIN_CLIENTE_OBRA
-- =====================================================
CREATE TABLE `FIN_CLIENTE_OBRA` (
  
  `CNO` varchar(20) DEFAULT '0',
  `PROJETO` varchar(90) DEFAULT '0',
  `RESPONSAVEL_TECNICO` int DEFAULT '0',
  `CREA` varchar(20) DEFAULT NULL,
  `ART` varchar(20) DEFAULT NULL,
  `CLIENTE` int NOT NULL,
  `STATUS` char(1) NOT NULL DEFAULT 'A' COMMENT 'A-Ativo, I-Inativo',
  `USERINSERT` int DEFAULT NULL,
  `DATEINSERT` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `USERCHANGE` int DEFAULT NULL,
  `DATECHANGE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 7. CRIAR TABELA FIN_CLIENTE_ENDERECO
-- =====================================================
CREATE TABLE `FIN_CLIENTE_ENDERECO` (
  
  `CLIENTE` int NOT NULL,
  `DESCRICAO` varchar(35) NOT NULL,
  `TIPOEND` varchar(15) DEFAULT 'RUA',
  `TITULOEND` varchar(15) DEFAULT NULL,
  `ENDERECO` varchar(60) DEFAULT 'SEM ENDERECO',
  `NUMERO` varchar(7) DEFAULT 'S/N',
  `COMPLEMENTO` varchar(15) DEFAULT NULL,
  `BAIRRO` varchar(20) DEFAULT NULL,
  `CIDADE` varchar(40) DEFAULT 'SEM CIDADE',
  `UF` varchar(2) DEFAULT 'PR',
  `CEP` int DEFAULT NULL,
  `HORARIO` time DEFAULT NULL,
  `FONEAREA` varchar(4) DEFAULT NULL,
  `FONE` varchar(9) DEFAULT NULL,
  `FONERAMAL` varchar(4) DEFAULT NULL,
  `FONECONTATO` varchar(15) DEFAULT NULL,
  `ENDENTREGAPADRAO` char(1) DEFAULT 'N',
  `ENDRETIRADAPADRAO` char(1) DEFAULT 'N',
  `PAIS` varchar(3) DEFAULT NULL,
  `STATUS` char(1) DEFAULT 'A',
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 8. CRIAR TABELA AMB_LOG
-- =====================================================
CREATE TABLE `AMB_LOG` (
  
  `ID_TABLE` int NOT NULL,
  `OPERACAO` varchar(10) COLLATE utf8mb3_bin DEFAULT NULL,
  `TABELA` varchar(20) COLLATE utf8mb3_bin DEFAULT NULL,
  `SQLSAVE` text COLLATE utf8mb3_bin,
  `USERINSERT` int DEFAULT NULL,
  `DATEINSERT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_bin;

-- 9. CRIAR TABELA AMB_EQUIPE
-- =====================================================
CREATE TABLE `AMB_EQUIPE` (
  
  `DESCRICAO` varchar(100) NOT NULL,
  `COR_EQUIPE` varchar(50) NOT NULL COMMENT 'COR DE IDENTIFICAÇÃO DA EQUIPE',
  `CREATED_USER` int NOT NULL COMMENT 'USUÁRIO QUE CRIOU O REGISTRO',
  `UPDATED_USER` int DEFAULT NULL COMMENT 'USUÁRIO QUE ATUALIZOU O REGISTRO',
  `CREATED_AT` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'DATA DE CRIAÇÃO',
  `UPDATED_AT` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'DATA DE ATUALIZAÇÃO',
  PRIMARY KEY (`ID`),
  UNIQUE KEY `UK_AMB_EQUIPE_DESCRICAO` (`DESCRICAO`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 10. CRIAR TABELA CAT_AT_EQUIPE_USUARIO
-- =====================================================
CREATE TABLE `CAT_AT_EQUIPE_USUARIO` (
  
  `ID_EQUIPE` int NOT NULL,
  `ID_USUARIO` int NOT NULL,
  `CAT_ATENDIMENTO_ID` int NOT NULL,
  `CREATED_USER` int NOT NULL COMMENT 'USUÁRIO QUE CRIOU O REGISTRO',
  `UPDATED_USER` int DEFAULT NULL COMMENT 'USUÁRIO QUE ATUALIZOU O REGISTRO',
  `CREATED_AT` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'DATA DE CRIAÇÃO',
  `UPDATED_AT` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'DATA DE ATUALIZAÇÃO',
  PRIMARY KEY (`ID`),
  UNIQUE KEY `UK_AT_EQUIPE_USUARIO_ATENDIMENTO` (`ID_EQUIPE`,`ID_USUARIO`,`CAT_ATENDIMENTO_ID`),
  KEY `CAT_ATENDIMENTO_ID` (`CAT_ATENDIMENTO_ID`),
  CONSTRAINT `CAT_AT_EQUIPE_USUARIO_ibfk_1` FOREIGN KEY (`ID_EQUIPE`) REFERENCES `AMB_EQUIPE` (`ID`) ON DELETE CASCADE,
  CONSTRAINT `CAT_AT_EQUIPE_USUARIO_ibfk_2` FOREIGN KEY (`CAT_ATENDIMENTO_ID`) REFERENCES `CAT_ATENDIMENTO` (`ID`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- 11. ADICIONAR CAMPOS ADICIONAIS NA TABELA CAT_AT_SERVICOS
-- =====================================================
ALTER TABLE `CAT_AT_SERVICOS` 
ADD COLUMN `QUANTIDADE_EXECUTADA` decimal(9,2) DEFAULT NULL AFTER `QUANTIDADE`;

-- 12. ADICIONAR CAMPOS ADICIONAIS NA TABELA FAT_PEDIDO_SERVICO
-- =====================================================
ALTER TABLE `FAT_PEDIDO_SERVICO` 
ADD COLUMN `QTD_CONTRATADA` decimal(9,2) DEFAULT NULL AFTER `UPDATED_AT`,
ADD COLUMN `QTD_EXECUTADA` decimal(9,2) DEFAULT NULL AFTER `QTD_CONTRATADA`,
ADD COLUMN `QTD_PENDENTE` decimal(9,2) DEFAULT NULL AFTER `QTD_EXECUTADA`;

-- 13. ADICIONAR CAMPO CENTROCUSTOENTREGA NA TABELA FAT_PEDIDO
-- =====================================================
ALTER TABLE `FAT_PEDIDO` 
ADD COLUMN `CENTROCUSTOENTREGA` int DEFAULT NULL AFTER `COMPRADOR`;

-- 14. ADICIONAR CAMPO VOLMARCA NA TABELA FAT_PEDIDO
-- =====================================================
ALTER TABLE `FAT_PEDIDO` 
ADD COLUMN `VOLMARCA` varchar(45) DEFAULT NULL AFTER `VOLPESOLIQ`;

-- 15. VERIFICAR SE O CAMPO PRODUTO JÁ EXISTE EM EST_NAT_OP_TRIBUTO
-- =====================================================
-- Se não existir, executar:
-- ALTER TABLE EST_NAT_OP_TRIBUTO ADD `PRODUTO` varchar(25) DEFAULT NULL AFTER CEST;

-- 16. ADICIONAR CAMPO MARCA NA TABELA EST_PRODUTO
-- =====================================================
ALTER TABLE `EST_PRODUTO` 
ADD COLUMN `MARCA` varchar(9) DEFAULT NULL AFTER `GRUPO`;

-- 17. ADICIONAR CAMPO VENDAPRESENCIAL NA TABELA EST_NOTA_FISCAL
-- =====================================================
ALTER TABLE `EST_NOTA_FISCAL` 
ADD COLUMN `VENDAPRESENCIAL` char(1) DEFAULT 'N' AFTER `GENERO`;

-- 18. ALTERAR TAMANHO DO CAMPO MARCA NA TABELA EST_MARCA
-- =====================================================
ALTER TABLE `EST_MARCA` 
MODIFY COLUMN `MARCA` varchar(9) NOT NULL;

-- 19. ADICIONAR CAMPOS ADICIONAIS NA TABELA EST_NOTA_FISCAL_PRODUTO
-- =====================================================
ALTER TABLE `EST_NOTA_FISCAL_PRODUTO` 
ADD COLUMN `CSTIPI` varchar(2) DEFAULT NULL AFTER `ENQIPI`,
ADD COLUMN `BCIPI` decimal(11,2) DEFAULT 0.00 AFTER `CSTIPI`,
ADD COLUMN `VICMSSUBSTITUTO` decimal(11,2) DEFAULT NULL AFTER `BCIPI`,
ADD COLUMN `PCREDSN` decimal(7,4) DEFAULT 0.0000 AFTER `VICMSSUBSTITUTO`,
ADD COLUMN `VCREDICMSSN` decimal(11,2) DEFAULT 0.00 AFTER `PCREDSN`,
ADD COLUMN `USRFATURA` varchar(3) DEFAULT NULL AFTER `VCREDICMSSN`,
ADD COLUMN `CUSTO` decimal(11,4) DEFAULT NULL AFTER `USRFATURA`,
ADD COLUMN `DESPESAS` decimal(11,4) DEFAULT NULL AFTER `CUSTO`,
ADD COLUMN `LUCROBRUTO` decimal(11,4) DEFAULT NULL AFTER `DESPESAS`,
ADD COLUMN `MARGEMLIQUIDA` decimal(11,4) DEFAULT NULL AFTER `LUCROBRUTO`,
ADD COLUMN `MARKUP` decimal(11,4) DEFAULT NULL AFTER `MARGEMLIQUIDA`,
ADD COLUMN `FRETE` decimal(11,4) DEFAULT NULL AFTER `MARKUP`,
ADD COLUMN `DESCONTOGERAL` decimal(11,4) DEFAULT NULL AFTER `FRETE`,
ADD COLUMN `DESPACESSORIAS` decimal(11,4) DEFAULT NULL AFTER `DESCONTOGERAL`,
ADD COLUMN `CODIGONOTA` varchar(60) DEFAULT NULL AFTER `DESPACESSORIAS`;

-- 20. INSERIR REGISTROS DE CST IPI NA TABELA AMB_DDM
-- =====================================================
INSERT INTO `AMB_DDM` (ALIAS,NRCAMPO,CAMPO,TIPO,TAMANHO,DECIMAIS,FORMATO,REQUERIDO,PADRAO,LEGENDA,MASCARA,NOMEEXTERNO,ALTERACAO,DESCRICAO,`SQL`,MENSAGEM,MENU) VALUES
('FAT_MENU',959,'CSTIPI','00',0,0,NULL,'N','00- ENTRADA COM RECUPERAÇÃO DE CRÉDITO',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',960,'CSTIPI','01',0,0,NULL,'N','01 - ENTRADA TRIBUTADA COM ALÍQUOTA ZERO',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',961,'CSTIPI','02',0,0,NULL,'N','02 - ENTRADA ISENTA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',962,'CSTIPI','03',0,0,NULL,'N','03 - ENTRADA NÃO TRIBUTADA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',963,'CSTIPI','04',0,0,NULL,'N','04 - ENTRADA IMUNE',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',964,'CSTIPI','05',0,0,NULL,'N','05 - ENTRADA COM SUSPENSÃO',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',965,'CSTIPI','51',0,0,NULL,'N','51 - SAÍDA TRIBUTADA COM ALÍQUOTA ZERO',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',966,'CSTIPI','52',0,0,NULL,'N','52 - SAÍDA ISENTA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',967,'CSTIPI','53',0,0,NULL,'N','53 - SAÍDA NÃO-TRIBUTADA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',968,'CSTIPI','54',0,0,NULL,'N','54 - SAÍDA IMUNE',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',969,'CSTIPI','55',0,0,NULL,'N','55 - SAÍDA COM SUSPENSÃO',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',970,'CSTIPI','99',0,0,NULL,'N','99 - OUTRAS SAÍDAS',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',971,'CSTIPI','49',0,0,NULL,'N','49 - OUTRAS ENTRADAS',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
('FAT_MENU',972,'CSTIPI','50',0,0,NULL,'N','50 - SAÍDA TRIBUTADA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);


-- 21. ADICIONAR CAMPO USER_COLOR NA TABELA AMB_USUARIO
-- =====================================================
ALTER TABLE `AMB_USUARIO` 
ADD COLUMN `USER_COLOR` varchar(15) DEFAULT NULL AFTER `FIMTARDE`;

-- 22. ADICIONAR CAMPO EQUIPE_ID NA TABELA CAT_ATENDIMENTO

-- 22.1. TRANSFORMAR VALORES VAZIOS EM NULL PARA CONVERSÃO DO CAMPO PRAZOENTREGA
-- =====================================================
UPDATE `CAT_ATENDIMENTO`
SET `PRAZOENTREGA` = NULL
WHERE TRIM(`PRAZOENTREGA`) = '';

-- 22.2. ALTERAR O TIPO DO CAMPO PRAZOENTREGA PARA DATETIME
-- =====================================================
ALTER TABLE `CAT_ATENDIMENTO`
MODIFY COLUMN `PRAZOENTREGA` datetime DEFAULT NULL;

-- =====================================================

-- 23. REMOVER PADRÃO DO CAMPO DATAABERATEND NA TABELA CAT_ATENDIMENTO
-- =====================================================
ALTER TABLE `CAT_ATENDIMENTO` 
MODIFY COLUMN `DATAABERATEND` timestamp NOT NULL;

-- 24. ADICIONAR CAMPO DATANASCIMENTO NA TABELA FIN_CLIENTE
-- =====================================================
ALTER TABLE `FIN_CLIENTE` 
ADD COLUMN `DATANASCIMENTO` date DEFAULT NULL AFTER `MALADIRETA`;

-- 25. ALTERAR CAMPO NOMEREDUZIDO PARA VARCHAR(60) NA TABELA FIN_CLIENTE
-- =====================================================
ALTER TABLE `FIN_CLIENTE` 
MODIFY COLUMN `NOMEREDUZIDO` varchar(60) NOT NULL;

-- 26. ADICIONAR CAMPOS ADICIONAIS NA TABELA FIN_CLIENTE_ACOMP
-- =====================================================
ALTER TABLE `FIN_CLIENTE_ACOMP` 
ADD COLUMN `PEDIDO_ID` int DEFAULT NULL AFTER `PESSOA`,
ADD COLUMN `USERINSERT` int DEFAULT NULL AFTER `CUSTOKM`,
ADD COLUMN `DATEINSERT` timestamp DEFAULT CURRENT_TIMESTAMP AFTER `USERINSERT`,
ADD COLUMN `USERCHANGE` int DEFAULT NULL AFTER `DATEINSERT`,
ADD COLUMN `DATECHANGE` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP AFTER `USERCHANGE`,
ADD COLUMN `STATUS` char(1) DEFAULT 'A' AFTER `DATECHANGE`;

-- 27. ADICIONAR CAMPOS NA TABELA CAT_SERVICO
-- =====================================================
ALTER TABLE `CAT_SERVICO` 
ADD COLUMN `SITUACAO_TRIBUTARIA` int DEFAULT NULL AFTER `VALORUNITARIO`,
ADD COLUMN `TRIBUTA_MUNICIPIO_PRESTADOR` char(1) DEFAULT NULL COMMENT '0 quando a tributação ocorre no local da prestação do serviço 1 quando a tributação ocorre no município do prestador' AFTER `SITUACAO_TRIBUTARIA`;

-- 28. CRIAR TABELA EST_NOTA_FISCAL_SERVICO_EVENTOS
-- =====================================================
CREATE TABLE `EST_NOTA_FISCAL_SERVICO_EVENTOS` (
  
  `ID_NFS` int NOT NULL,
  `CENTRO_CUSTO` varchar(11) NOT NULL,
  `SERIE` varchar(3) DEFAULT NULL,
  `NUMERO` int DEFAULT NULL,
  `TIPO_EVENTO` char(1) DEFAULT NULL COMMENT 'C - Cancelamento, E - Emissão, S - Solicitação de cancelamento (após o prazo), N - Consulta de NFS',
  `CODIGO_RETORNO` varchar(10) DEFAULT NULL,
  `XML_RETORNO` text,
  `CREATED_USER` int DEFAULT NULL,
  `CREATED_AT` timestamp DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 29. CRIAR TABELA EST_SERVICOS_CODIGOS
-- =====================================================
CREATE TABLE `EST_SERVICOS_CODIGOS` (
  
  `CODIGO` varchar(10) NOT NULL,
  `SERVICO` text NOT NULL,
  `ALIQUOTA` decimal(5,2) NOT NULL,
  `RETENCAO` char(1) NOT NULL COMMENT '0 - Não, 1 - Sim',
  `RETENCAO_LEI_189_25` char(1) NOT NULL COMMENT '0 - Não, 1 - Sim',
  `OBRAS` char(1) NOT NULL COMMENT '0 - Não, 1 - Sim',
  `UF` varchar(2) NOT NULL,
  `COD_MUNICIPIO` varchar(10) NOT NULL,
  `MUNICIPIO` varchar(30) NOT NULL,
  `CREATED_USER` int DEFAULT NULL,
  `CREATED_AT` datetime DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_USER` int DEFAULT NULL,
  `UPDATED_AT` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 30. CRIAR TABELA EST_NOTA_FISCAL_SERVICO
-- =====================================================
CREATE TABLE `EST_NOTA_FISCAL_SERVICO` (
  
  `IDENTIFICADOR_ARQUIVO` varchar(80) DEFAULT NULL UNIQUE,
  `NUMERO` int DEFAULT NULL,
  `SERIE` int DEFAULT NULL,
  `DATA_EMISSAO` date DEFAULT NULL,
  `HORA_EMISSAO` time DEFAULT NULL,
  `COD_VERIFICADOR_AUTENTICIDADE` varchar(16) DEFAULT NULL,
  `LINK_NFSE` varchar(500) DEFAULT NULL,
  `SITUACAO` int(1) DEFAULT NULL COMMENT '1-Emitida / 2-Cancelada',
  `RPS_NUMERO` varchar(9) DEFAULT NULL,
  `RPS_SERIE` varchar(2) DEFAULT NULL,
  `RPS_DATA_EMISSAO` date DEFAULT NULL,
  `RPS_HORA_EMISSAO` time DEFAULT NULL,
  `COD_EQUIPAMENTO_AUTOMATICO` varchar(100) DEFAULT NULL,
  `DATA_FATO_GERADOR` date DEFAULT NULL,
  `OBSERVACAO` varchar(1000) DEFAULT NULL,
  `VALOR_TOTAL` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_DESCONTO` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_IR` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_INSS` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_CONTRIBUICAO_SOCIAL` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_RPS_RETENCAO` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_PIS` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_COFINS` decimal(15,2) NOT NULL DEFAULT 0.00,
  `PRESTADOR_CPFCNPJ` varchar(14) DEFAULT NULL,
  `PRESTADOR_CIDADE_CODIGO` int DEFAULT NULL,
  `TOMADOR_ID` int NOT NULL,
  `TOMADOR_CPFCNPJ` varchar(14) DEFAULT NULL,
  `TOMADOR_TIPO` char(1) DEFAULT NULL COMMENT 'F-Física / J-Jurídica / E-Estrangeiro',
  `TOMADOR_NOME_RAZAO_SOCIAL` varchar(100) DEFAULT NULL,
  `TOMADOR_NOME_FANTASIA` varchar(100) DEFAULT NULL,
  `TOMADOR_IE` varchar(16) DEFAULT NULL,
  `TOMADOR_EMAIL` varchar(100) DEFAULT NULL,
  `TOMADOR_ENDERECO_INFORMADO` char(1) DEFAULT NULL COMMENT '1-Sim / 0-Não',
  `TOMADOR_LOGRADOURO` varchar(70) DEFAULT NULL,
  `TOMADOR_NUMERO_RESIDENCIA` varchar(8) DEFAULT NULL,
  `TOMADOR_COMPLEMENTO` varchar(50) DEFAULT NULL,
  `TOMADOR_BAIRRO` varchar(30) DEFAULT NULL,
  `TOMADOR_CIDADE_CODIGO` varchar(100) DEFAULT NULL,
  `TOMADOR_CEP` varchar(8) DEFAULT NULL,
  `TOMADOR_PONTO_REFERENCIA` varchar(100) DEFAULT NULL,
  `TOMADOR_DDD_FONE_COMERCIAL` varchar(3) DEFAULT NULL,
  `TOMADOR_FONE_COMERCIAL` varchar(9) DEFAULT NULL,
  `TOMADOR_DDD_FONE_RESIDENCIAL` varchar(3) DEFAULT NULL,
  `TOMADOR_FONE_RESIDENCIAL` varchar(9) DEFAULT NULL,
  `TOMADOR_DDD_FAX` varchar(3) DEFAULT NULL,
  `TOMADOR_FONE_FAX` varchar(9) DEFAULT NULL,
  `TOMADOR_IDENTIFICADOR_ESTRANGEIRO` varchar(20) DEFAULT NULL,
  `TOMADOR_ESTADO_ESTRANGEIRO` varchar(100) DEFAULT NULL,
  `TOMADOR_PAIS_ESTRANGEIRO` varchar(100) DEFAULT NULL,
  `PRODUTOS_DESCRICAO` varchar(200) DEFAULT NULL COMMENT 'Tudo que se quer que saia na nota a respeito dos produtos',
  `PRODUTOS_VALOR_TOTAL` decimal(15,2) NOT NULL DEFAULT 0.00,
  `FORMA_PAGAMENTO_TIPO` int DEFAULT NULL COMMENT '1-À vista / 2-A prazo / 3-Na Apresentação / 4-Cartão de Débito / 5-Cartão de Crédito',
  `CREATED_USER` int NOT NULL,
  `CREATED_AT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_USER` int DEFAULT NULL,
  `UPDATED_AT` timestamp NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 31. CRIAR TABELA EST_NOTA_FISCAL_SERVICO_ITEM
-- =====================================================
CREATE TABLE `EST_NOTA_FISCAL_SERVICO_ITEM` (
  
  `ID_NOTA_FISCAL_SERVICO` int NOT NULL,
  `ID_CAT_SERVICO` int NOT NULL,
  `TRIBUTA_MUNICIPIO_PRESTADOR` char(1) DEFAULT NULL COMMENT '1-Sim (tributação ocorre no município do prestador) / 0-Não (tributação ocorre no local da prestação do serviço)',
  `CODIGO_LOCAL_PRESTACAO_SERVICO` int DEFAULT NULL,
  `CODIGO_ITEM_LISTA_SERVICO` varchar(9) DEFAULT NULL,
  `DESCRITIVO` varchar(1000) DEFAULT NULL,
  `ALIQUOTA` decimal(5,2) NOT NULL DEFAULT 0.00,
  `SITUACAO_TRIBUTARIA` int DEFAULT NULL,
  `VALOR_TRIBUTAVEL` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_DEDUCAO` decimal(15,2) NOT NULL DEFAULT 0.00,
  `VALOR_ISSRF` decimal(15,2) NOT NULL DEFAULT 0.00,
  `UNIDADE_CODIGO` int DEFAULT NULL,
  `UNIDADE_QUANTIDADE` decimal(15,2) DEFAULT NULL,
  `UNIDADE_VALOR_UNITARIO` decimal(15,2) NOT NULL DEFAULT 0.00,
  `CREATED_USER` int NOT NULL,
  `CREATED_AT` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_USER` int DEFAULT NULL,
  `UPDATED_AT` timestamp NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`),
  KEY `fk_EST_NOTA_FISCAL_SERVICO_ITEM_EST_NOTA_FISCAL_SERVICO1_idx` (`ID_NOTA_FISCAL_SERVICO`),
  KEY `fk_EST_NOTA_FISCAL_SERVICO_ITEM_CAT_SERVICO1_idx` (`ID_CAT_SERVICO`),
  CONSTRAINT `fk_EST_NOTA_FISCAL_SERVICO_ITEM_EST_NOTA_FISCAL_SERVICO1` FOREIGN KEY (`ID_NOTA_FISCAL_SERVICO`) REFERENCES `EST_NOTA_FISCAL_SERVICO` (`ID`),
  CONSTRAINT `fk_EST_NOTA_FISCAL_SERVICO_ITEM_CAT_SERVICO1` FOREIGN KEY (`ID_CAT_SERVICO`) REFERENCES `CAT_SERVICO` (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 32. CRIAR TABELA CAT_AT_EQUIPE
-- =====================================================
CREATE TABLE `CAT_AT_EQUIPE` (
  
  `CAT_ATENDIMENTO_ID` int NOT NULL,
  `EQUIPE_EQUIPAMENTO_ID` int NOT NULL,
  `CAT_USUARIO_ID` int NOT NULL,
  `CREATED_USER` int DEFAULT NULL,
  `UPDATED_USER` int DEFAULT NULL,
  `CREATED_AT` timestamp DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_AT` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb3;

-- 33. ADICIONAR CAMPOS ADICIONAIS NA TABELA FAT_PEDIDO
-- =====================================================
ALTER TABLE `FAT_PEDIDO` 
ADD COLUMN `ODESFERICO` varchar(10) DEFAULT NULL AFTER `IDAGRUPAMENTO`,
ADD COLUMN `OEESFERICO` varchar(10) DEFAULT NULL AFTER `ODESFERICO`,
ADD COLUMN `ODCILINDRICO` varchar(10) DEFAULT NULL AFTER `OEESFERICO`,
ADD COLUMN `OECILINDRICO` varchar(10) DEFAULT NULL AFTER `ODCILINDRICO`,
ADD COLUMN `ODEIXO` varchar(10) DEFAULT NULL AFTER `OECILINDRICO`,
ADD COLUMN `OEEIXO` varchar(10) DEFAULT NULL AFTER `ODEIXO`,
ADD COLUMN `ODAD` varchar(10) DEFAULT NULL AFTER `OEEIXO`,
ADD COLUMN `OEAD` varchar(10) DEFAULT NULL AFTER `ODAD`,
ADD COLUMN `MEDICO` varchar(60) DEFAULT NULL AFTER `OEAD`,
ADD COLUMN `OPORTUNIDADE` text DEFAULT NULL AFTER `MEDICO`,
ADD COLUMN `APRESENTACAO` text DEFAULT NULL AFTER `OPORTUNIDADE`,
ADD COLUMN `OBJETIVO` text DEFAULT NULL AFTER `APRESENTACAO`,
ADD COLUMN `GARANTIA` text DEFAULT NULL AFTER `OBJETIVO`,
ADD COLUMN `IMPOSTOS` text DEFAULT NULL AFTER `GARANTIA`,
ADD COLUMN `VALIDADE` text DEFAULT NULL AFTER `IMPOSTOS`,
ADD COLUMN `ACEITE` text DEFAULT NULL AFTER `VALIDADE`;

-- 34. ADICIONAR CAMPO PRECCREDITOSIMPLES NA TABELA EST_NAT_OP
-- =====================================================
ALTER TABLE `EST_NAT_OP` 
ADD COLUMN `PRECCREDITOSIMPLES` decimal(5,2) DEFAULT NULL AFTER `TRIBSIMPLES`;

-- 35. ADICIONAR CAMPO ANP NA TABELA EST_PRODUTO
-- =====================================================
ALTER TABLE `EST_PRODUTO` 
ADD COLUMN `ANP` text DEFAULT NULL AFTER `PERCCALCULO`;

-- 36. ALTERAR CAMPO GENERO PARA VARCHAR(6) NA TABELA FIN_LANCAMENTO
-- =====================================================
ALTER TABLE `FIN_LANCAMENTO` 
MODIFY COLUMN `GENERO` varchar(6) NOT NULL;

-- =====================================================
-- FIM DAS ALTERAÇÕES DOS ARQUIVOS DE ATUALIZAÇÃO
-- =====================================================
